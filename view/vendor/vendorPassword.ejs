<%- include('../layouts/header.ejs') %>

<div class="container-scroller">
  <div class="container-fluid page-body-wrapper full-page-wrapper">
    <div class="content-wrapper d-flex align-items-center auth">
      <div class="row flex-grow">
        <div class="col-lg-4 mx-auto d-flex align-items-center justify-content-between">
          <div class="auth-form-light text-left p-5" id="loginnn">
            <div class="brand-logo">
              <img src="../../assets/images/logo.svg" />
            </div>
            <h6 class="font-weight-light">Sign Up to continue.</h6>
            <form id="passwordForm" class="pt-3">
              <div class="form-group">
                <input
                  type="password"
                  class="form-control form-control-lg"
                  id="InputPassword1"
                  placeholder="Password"
                  name="password"
                  required
                />
              </div>
              <div class="form-group">
                <input
                  type="password"
                  class="form-control form-control-lg"
                  id="InputConfirmPassword"
                  placeholder="Confirm Password"
                  name="confirmPassword"
                  required
                />
              </div>
              <!-- Add a hidden input field for user ID -->
              <input type="hidden" id="id" >

              <div class="mt-3 d-flex justify-content-between align-items-center">
                <button
                  type="button"
                  class="btn btn-block btn-gradient-primary btn-lg font-weight-medium auth-form-btn"
                  onclick="setPassword()"
                >
                  SUBMIT
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- content-wrapper ends -->
  </div>
  <!-- page-body-wrapper ends -->
</div>

<script>
  const currentURL = window.location.href;
  const { pathname } = new URL(currentURL);
  const pathSegments = pathname.split("/");
  const userId = pathSegments[pathSegments.length - 1];

  console.log("ID:", userId);

  async function setPassword() {
    try {
      const password = document.getElementById("InputPassword1").value;
      const confirmPassword = document.getElementById("InputConfirmPassword").value;

      console.log("userId------------", userId);

      const response = await fetch(`http://localhost:3000/vendor/set-Password/${userId}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ password, confirmPassword }),
      });

      const data = await response.json();

      if (response.ok) {
        window.location.href = '/vendor-dashboard';
        console.log(data.message);
      } else {
        console.error(data.message);
      }
    } catch (error) {
      console.error("Error during setPassword:", error);
    }
  }
</script>
