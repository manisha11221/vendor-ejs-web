<!-- vendorDash.ejs -->
<%- include('../../layouts/header.ejs') %>
 <%- include('../../layouts/sidebar.ejs') %>

<div class="container-scroller">
  <div class="container-fluid page-body-wrapper">
    <div class="main-panel">
      <div class="content-wrapper">
        <!-- Add your vendor data table here -->
        <div class="row">
          <div class="col-md-12">
            <div class="page-header">
              <h3 class="page-title">Vendor Dashboard</h3>
            </div>

            <div class="card">
              <div class="card-body">
                <h4 class="card-title">All Vendors</h4>
                <div class="table-responsive">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th>Sr.No</th>
                        <th>ID</th>
                        <th>Email</th>
                        <!-- Add more columns based on your vendor model -->
                      </tr>
                    </thead>
                    <tbody id="vendorTableBody">
                      <!-- Table rows will be dynamically populated here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- End of vendor data table -->
      </div>
      <!-- content-wrapper ends -->
    </div>
  </div>
</div>
<%- include('../../layouts/footer.ejs') %>
<!-- Inline script to fetch and populate data -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Fetch data from the API
    fetch("http://localhost:3000/vendor/get-all-Vendors")
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((data) => {
        if (data.success) {
          // Populate the table with the received data
          var vendorTableBody = document.getElementById("vendorTableBody");

          data.vendors.forEach(function (vendor, index) {
            var row =
              "<tr>" +
              "<td>" +
              (index + 1) +
              "</td>" + // Add serial number
              "<td>" +
              vendor._id +
              "</td>" +
              "<td>" +
              vendor.email +
              "</td>" +
              "</tr>";
            vendorTableBody.innerHTML += row;
          });
        } else {
          console.error("API response indicates failure:", data.message);
        }
      })
      .catch((error) => {
        console.error("Error fetching vendors:", error);
      });
  });

  const tokens = localStorage.getItem("adminToken");

  if (!tokens) {
    // Redirect to the login page if the token is not present
    window.location.href = "/login";
  }
</script>
