<!-- vendorDash.ejs -->
<%- include('../../layouts/header.ejs') %> <%-
include('../../layouts/sidebar.ejs') %>

<div class="container-scroller">
  <div class="container-fluid page-body-wrapper">
    <div class="main-panel">
      <div class="content-wrapper">
        <!-- Add your vendor data table here -->
        <div class="row">
          <div class="col-md-12">
            <div class="page-header">
              <h3 class="page-title">Vendor Dashboard</h3>
            </div>

            <div class="card mb-5">
              <div class="card-body">
                <h4 class="card-title">All Vendors</h4>
                <div class="table-responsive">
                  <table class="table table-striped" id="vendorTable">
                    <thead>
                      <tr>
                        <th>Sr.No</th>
                        <th>Email</th>
                        <th>Address</th>
                        <th>Company Name</th>
                        <th>GST Number</th>
                        <th>Developer Count</th>
                        
                        <!-- Add more columns based on your vendor model -->
                      </tr>
                    </thead>

                    <tbody id="vendorTableBody">
                      <!-- Table rows will be dynamically populated here -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
       
      </div>
    
    </div>
  </div>
</div>
<%- include('../../layouts/footer.ejs') %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    fetch("http://localhost:3000/vendor/get-all-Vendors")
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((data) => {
        if (data.success) {
          var vendorTable = $("#vendorTable").DataTable();

          data.vendors.forEach(function (vendor, index) {
            const developerCount = vendor.developers.length;

            vendorTable.row
              .add([
                index + 1,
                vendor.email,
                vendor.address,
                vendor.company_name,
                vendor.gst_number,
                developerCount > 0 ? developerCount : "No Developer added",
              ])
              .draw();
          });
        } else {
          console.error("API response indicates failure:", data.message);
        }
      })
      .catch((error) => {
        console.error("Error fetching vendors:", error);
      });
  });

  const tokens = localStorage.getItem("adminToken");

  if (!tokens) {
    window.location.href = "/login";
  }
</script>
